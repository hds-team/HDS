<link type="text/css" rel="stylesheet" href="<?php echo base_url();?>css/emt_css/tooltip/tooltip2/qtip.css">
<script type="text/javascript" src="<?php echo base_url();?>css/emt_css/tooltip/tooltip2/jquery-1.js"></script>
<script type="text/javascript" src="<?php echo base_url();?>css/emt_css/tooltip/tooltip2/jquery.js"></script>
<link type="text/css" rel="stylesheet" href="<?php echo base_url();?>css/emt_css/ui.css">
<script type="text/javascript" src="<?php echo base_url(); ?>js/emt_js/ui.js"></script>
<!-- jQuery JavaScript File -->
<script type="text/javascript" src="<?php echo base_url().$this->config->item("emt_dandelion_folder");?>js/jquery-1.7.2.min.js"></script>

<!-- jQuery-UI JavaScript Files -->
<script type="text/javascript" src="<?php echo base_url().$this->config->item("emt_dandelion_folder");?>jui/js/jquery-ui-1.8.20.min.js"></script>
<script type="text/javascript" src="<?php echo base_url().$this->config->item("emt_dandelion_folder");?>jui/js/jquery.ui.timepicker.min.js"></script>
<script type="text/javascript" src="<?php echo base_url().$this->config->item("emt_dandelion_folder");?>jui/js/jquery.ui.touch-punch.min.js"></script>
<link rel="stylesheet" type="text/css" href="<?php echo base_url().$this->config->item("emt_dandelion_folder");?>jui/css/jquery.ui.all.css" media="screen" />

<!-- Plugin Files -->

<!-- FileInput Plugin -->
<script type="text/javascript" src="<?php echo base_url().$this->config->item("emt_dandelion_folder");?>js/jquery.fileinput.js"></script>
<!-- Placeholder Plugin -->
<script type="text/javascript" src="<?php echo base_url().$this->config->item("emt_dandelion_folder");?>js/jquery.placeholder.js"></script>
<!-- Mousewheel Plugin -->
<script type="text/javascript" src="<?php echo base_url().$this->config->item("emt_dandelion_folder");?>js/jquery.mousewheel.min.js"></script>
<!-- Scrollbar Plugin -->
<script type="text/javascript" src="<?php echo base_url().$this->config->item("emt_dandelion_folder");?>js/jquery.tinyscrollbar.min.js"></script>
<!-- Tooltips Plugin -->
<script type="text/javascript" src="<?php echo base_url().$this->config->item("emt_dandelion_folder");?>plugins/tipsy/jquery.tipsy-min.js"></script>
<link rel="stylesheet" href="<?php echo base_url().$this->config->item("emt_dandelion_folder");?>plugins/tipsy/tipsy.css" />

<!-- PrettyCheckboxes Plugin -->
<script type="text/javascript" src="<?php echo base_url().$this->config->item("emt_dandelion_folder");?>plugins/prettycheckboxes/js/prettyCheckboxes.js"></script>
<link rel="stylesheet" href="<?php echo base_url().$this->config->item("emt_dandelion_folder");?>plugins/prettycheckboxes/css/style.css" media="screen" />

<!-- Spinner Plugin -->
<script type="text/javascript" src="<?php echo base_url().$this->config->item("emt_dandelion_folder");?>jui/js/jquery.ui.spinner.min.js"></script>

<!-- Chosen Plugin -->
<script type="text/javascript" src="<?php echo base_url().$this->config->item("emt_dandelion_folder");?>plugins/chosen/chosen.jquery.js"></script>
<link rel="stylesheet" href="<?php echo base_url().$this->config->item("emt_dandelion_folder");?>plugins/chosen/chosen.css" media="screen" />

<!-- Picklist Plugin -->
<script type="text/javascript" src="<?php echo base_url().$this->config->item("emt_dandelion_folder");?>js/core/plugins/picklist/jquery.picklist.min.js"></script>
<link rel="stylesheet" href="<?php echo base_url().$this->config->item("emt_dandelion_folder");?>js/core/plugins/picklist/jquery.picklist.css" media="screen" />

<!-- Colorpicker Plugin -->
<script type="text/javascript" src="<?php echo base_url().$this->config->item("emt_dandelion_folder");?>plugins/colorpicker/colorpicker.js"></script>
<link rel="stylesheet" href="<?php echo base_url().$this->config->item("emt_dandelion_folder");?>plugins/colorpicker/colorpicker.css" media="screen" />

<!-- elRTE Plugin -->
<script type="text/javascript" src="<?php echo base_url().$this->config->item("emt_dandelion_folder");?>plugins/elrte/js/elrte.full.js"></script>
<link rel="stylesheet" href="<?php echo base_url().$this->config->item("emt_dandelion_folder");?>plugins/elrte/css/elrte.css" media="screen" />

<!-- elFinder Plugin -->
<script type="text/javascript" src="<?php echo base_url().$this->config->item("emt_dandelion_folder");?>plugins/elfinder/js/elfinder.min.js"></script>
<link rel="stylesheet" href="<?php echo base_url().$this->config->item("emt_dandelion_folder");?>plugins/elfinder/css/elfinder.css" media="screen" />

<!-- iButton Plugin -->
<script type="text/javascript" src="<?php echo base_url().$this->config->item("emt_dandelion_folder");?>plugins/ibutton/lib/jquery.ibutton.min.js"></script>
<link rel="stylesheet" href="<?php echo base_url().$this->config->item("emt_dandelion_folder");?>plugins/ibutton/css/jquery.ibutton-giva-original.css" media="screen" />

<!-- Demo JavaScript Files -->
<script type="text/javascript" src="<?php echo base_url().$this->config->item("emt_dandelion_folder");?>plugins/elastic/jquery.elastic.min.js"></script>
<script type="text/javascript" src="<?php echo base_url().$this->config->item("emt_dandelion_folder");?>js/demo/demo.form.js"></script>

<!-- Core JavaScript Files -->
<script type="text/javascript" src="<?php echo base_url().$this->config->item("emt_dandelion_folder");?>js/core/dandelion.core.js"></script>

<!-- Customizer JavaScript File (remove if not needed) -->
<script type="text/javascript" src="<?php echo base_url().$this->config->item("emt_dandelion_folder");?>js/core/dandelion.customizer.js"></script>

<!-- tab -->
<!-- Validation Plugin -->
<script type="text/javascript" src="<?php echo base_url().$this->config->item("emt_dandelion_folder");?>plugins/validate/jquery.validate.min.js"></script>

<!-- Demo JavaScript Files -->
<script type="text/javascript" src="<?php echo base_url().$this->config->item("emt_dandelion_folder");?>js/demo/demo.ui.js"></script>
<!-- tab -->
<script type="text/javascript">
  if (document.location.hash == "" || document.location.hash == "#")
    document.location.hash = "#tabs-2";
</script>
<!----------->
<!-- fancybox -->
<script type="text/javascript" src="<?php echo base_url(); ?>js/emt_js/fancybox.js"></script>
<?php 
echo link_tag('css/emt_css/fancybox/fancybox.css');

$status = isset($status);
?>

<script type="text/javascript">
$(document).ready(function(){
	// Add Event
	$("#back").click(back);
	$("#btnnextto3").click(chkform);
	//egoist
	$("#chk_all").live("click",getChecked);
	$(".BB").live("click",getChecked);
	//egoist
	// set class sortable for sortable
	$(".sortable").sortable({
		placeholder: "ui-state-highlight",
		opacity: 0.95,
		delay: 50,
		stop:function(event, ui){
			var url = "<?php echo site_url() . "/emeeting/emeeting/pntSeq"; ?>";
			var index = $(this).sortable('toArray');
			$.post(url,{index:[index]},function(data){
			});
		}
	});
	
	$('span[title].subindex').qtip({
		position: {
			corner: {
				 target: 'topRight',
				tooltip: 'bottomLeft'
			}
		},
		style: {
			name: 'cream',
			padding: '7px 13px',
			width: {
				max: 210,
				min: 0
			},
			tip: true
		}
	});
	
	function chkform(){
		var flag = 0;
		for( i in arr_pnt_ag ){
			ag_id = arr_pnt_ag[i];
			for( j in ag_ok ){
				if(ag_id == ag_ok[j]){
					flag = 1;
					break;
				}
			}
		}
		if(flag == 0){
			alert("การกำหนดบุคลากร จำเป็นต้องมี ผู้ที่มีสิทธิ์ในการจัดประชุมอย่างน้อย 1 คน");
			$("fieldset comment").css("border","1px solid #FFAAAA").css("background","#FFFAFA");
			setTimeout(function(){
				$("fieldset comment").css("border","1px solid #FFFFFF").css("background","#FFFFFF");
			},4500);
			return false;
		}
		return true;
	}
	
	function back(){
		var flag_ok = 1;
		flag_ok = chkform();
		if(flag_ok == 1){
			url = site_url+"emeeting/emeetingView";
			sendPost("frm", {cms_id:<?php echo $cms_id; ?>,mt_id:<?php echo $mt_id; ?>}, url, "", "")
		}
	}
});

function pntCharge(pnt_id){
	$.fancybox({
		'height' 			: '50%',
		'width' 			: '75%',
		'transitionIn'		: 'none',
		'transitionOut'		: 'none',
		'type'				: 'iframe',
		'href'				: site_url+"emeeting/emeetingAddCharge/"+pnt_id,
		'onClosed'			: function() {
								url = site_url + "<?php 
									if($status != "edit"){
										echo "emeeting/emeetingAdd/#close_ok";
									}
									else{
										echo "emeeting/emeetingEditPtp/#close_ok";
									}
								?>";
								sendPost("pntCharge",{"step":"2","mt_id":<?php echo $mt_id; ?>,"cms_id":<?php echo $cms_id; ?>,"pnt_id":pnt_id},url,"","");
							}
	});
}

function pntEdit(pnt_id){
	var url = site_url + "<?php 
		if($status != "edit"){
			echo "emeeting/emeetingAdd";
		}
		else{
			echo "emeeting/emeetingEditPtp";
		}
	?>";
	sendPost("pntEdit",{"step":"2","mt_id":<?php echo $mt_id; ?>,"cms_id":<?php echo $cms_id; ?>,"pnt_id":pnt_id,"flag_edit":"1"},url,"","");
}

function pntDel(pnt_id, warnMsg){
	var url = site_url + "<?php 
		if($status != "edit"){
			echo "emeeting/emeetingAdd";
		}
		else{
			echo "emeeting/emeetingEditPtp";
		}
	?>";
	sendPost("pntDel",{"step":"2","mt_id":<?php echo $mt_id; ?>,"cms_id":<?php echo $cms_id; ?>,"pnt_id":pnt_id,"flag_del":"1"},url,"","คุณต้องการลบ \""+warnMsg+"\" ใช่หรือไม่");
}
//egoist
	function getChecked()
	{
		if($(this).attr("checked") == "checked")
		{
			$("#btnSubmit").removeAttr("disabled");
		}
	}
	
	function chkList(flag,tclass)
	{
	if(flag == 1){
		$("."+tclass).attr("checked",true);
	}
	else{
		$("."+tclass).attr("checked",false);
	}
	}
//egoist
// Implement to your program
function acLink(id){
	var data = globaldata[id];
	if(get == "getPerson"){ //link in Person
		//set value in Person
		obj.parents(".type1").find("input[name^=pnt_personId]").val(data.personId);
		obj.parents(".type1").find("input[name^=personName]").val(data.name);
		//set value in adminName
		obj.parents(".type1").find("input[name^=pnt_adminId]").val(data.adminId);
		obj.parents(".type1").find("input[name^=adminName]").val(data.adminName);
		obj.parents(".type1").find("input[name^=pnt_deptId]").val(data.deptId);
		//set value in deptname
		obj.parents(".type1").find("input[name^=pnt_dpId]").val(data.dpId);
		obj.parents(".type1").find("input[name^=deptName]").val(data.deptName); 
		//set value in email	
		obj.parents(".type1").find("input[name^=pnt_email]").val(data.email); 
	} 
	/*
	//-- 2013-04-01 meuzicxx โครงสร้างยังไม่เรียบร้อย
	else if(get == "getAdmin"){
		//set value in Admin
		obj.parents(".type2").find("input[name^=pnt_adminId]").val(data.adminId);
		obj.parents(".type2").find("input[name^=pnt_adminposId]").val(data.adminposId);
		obj.parents(".type2").find("input[name^=adminName]").val(data.name);
		//set value in Person
		obj.parents(".type2").find("input[name^=pnt_personId]").val(data.personId);
		obj.parents(".type2").find("input[name^=personName]").val(data.personName);
		//set value in deptName
		obj.parents(".type2").find("input[name^=pnt_deptId]").val(data.deptId);
		obj.parents(".type2").find("input[name^=deptName]").val(data.deptName);
		//set value in email	
		obj.parents(".type2").find("input[name^=pnt_email]").val(data.email); 
	}*/
	
	$(".autocomplete-block").remove();
}
function acStart(obj){
	if(get == "getPerson"){ //link in Person
		personId = obj.parent().find("input[name^=pnt_personId]").val();
		if(personId > 0){
			obj.parents(".type1").find("input[name^=pnt_personId]").val("");
			obj.parents(".type1").find("input[name^=pnt_adminId]").val("");
			obj.parents(".type1").find("input[name^=pnt_deptId]").val("");
			obj.parents(".type1").find("input[name^=adminName]").val("");
			obj.parents(".type1").find("input[name^=pnt_dpId]").val("");
			obj.parents(".type1").find("input[name^=deptName]").val("บุคคลภายนอก");
			obj.parents(".type1").find("input[name^=pnt_email]").val("");
		}
	}
	/*
	//-- 2013-04-01 meuzicxx โครงสร้างยังไม่เรียบร้อย
	else if(get == "getAdmin"){
		adminId = obj.parent().find("input[name^=pnt_adminId]").val();
		if(adminId > 0){
			obj.parents(".type2").find("input[name^=pnt_adminId]").val("");
			obj.parents(".type2").find("input[name^=pnt_personId]").val("");
			obj.parents(".type2").find("input[name^=personName]").val("");
			obj.parents(".type2").find("input[name^=pnt_deptId]").val("");
			obj.parents(".type2").find("input[name^=deptName]").val("บุคคลภายนอก");
			obj.parents(".type2").find("input[name^=pnt_email]").val("");
		}
	}*/
}

</script>
<style>
	.sortable{
		width : 100%;
		margin : 0px;
		padding : 0px;
	}
	.sortable tr{
		line-height : 25px;
		list-style: none;
		margin : 0px;
		padding : 0px;
		padding-left : 20px;
		cursor:move;
		border : 1px solid #FFFFFF;
	}
	.sortable tr:hover{
		border : 1px solid #D0DCF0;
	}
	.sortable tr.ui-state-highlight { 
		height : 30px;
		line-height : 30px;
		background : #D0DCF0;
	}
	tr.ui-sortable-helper{
		border : 1px solid #fad42e;
		background: #FAFAFA;
		
	}
	.icon{
		cursor : pointer;
	}
	select.validate{
		width :	150px;
		margin : 0px 5px;
	}
	.selectPaticipant{
		width : 150px;
	}
</style>
	
	<?php /*if(strpos($_SERVER['HTTP_USER_AGENT'], 'MSIE') !== FALSE) { ?>
		<div id="guide_ie">
			<?php
			if(isset($menu)){
				echo guide($menu,2);
			} else {
				$back = array(
					"src" => "images/emeeting/icons/back.png"
				);
				$imgBack = img($back);
				echo "<a class=\"icon\" id=\"back\">{$imgBack}</a>";
			}
			?>
		</div>
	<?php } else { ?>
		<div id="guide">
			<?php
			if(isset($menu)){
				echo guide($menu,2);
			} else {
				$back = array(
					"src" => "images/emeeting/icons/back.png"
				);
				$imgBack = img($back);
				echo "<a class=\"icon\" id=\"back\">{$imgBack}</a>";
			}
			?>
		</div>
	<?php } */?>
	<div class="grid_4_center">
			<div id="da-ex-tabs-plain">
				<ul>
					<li><a href="#">กำหนดสร้างการประชุม</a></li>
					<li><a href="#tabs-2">กำหนดบุคลากร</a></li>
					<li><a href="#">กำหนดอีเมล์</a></li>
					<li><a href="#">กำหนดระเบียบวาระ</a></li>
					<li><a href="#">ยืนยัน</a></li>
				</ul>
				<div id="tabs-">
				</div>
				<div id="tabs-2">
				</div>
	<div id="content-body">
		<h3>กำหนดบุคลากร &nbsp;&nbsp;</h3>
		
		<p>&nbsp;</p>
		<?php
			$save = array(
				"src" => "images/emeeting/icons/save_green.png",
				"width" => "20",
				"border" => "0"
			);
			$imgSave = img($save);
			
			
			$charge = array(
				"src" => "images/emeeting/icons/user_charge.png",
				"width" => "16",
				"border" => "0"
			);
			$imgCharge = img($charge);
			
			$edit = array(
				"src" => "images/emeeting/icons/edit.png",
				"width" => "16",
				"border" => "0"
			);
			$imgEdit = img($edit);
			
			$del = array(
				"src" => "images/emeeting/icons/del.png",
				"width" => "16",
				"border" => "0"
			);
			$imgDel = img($del);
			
			if($status != "edit"){
				$action = "emeeting/emeetingAdd";
				$actionForGroup = "emeeting/meetingAddPntByGroupSave";
			}
			else{
				$action = "emeeting/emeetingEditPtp";
				$actionForGroup = "emeeting/meetingEditPntByGroupSave";
			}
			
			// Load model
			$arr_model = isset($arr_model) ? $arr_model : "";
			
			$pnt_id = $pnt_personId = $pnt_op_id = $name = $pnt_adminId = $pnt_deptId = $pnt_dpId = $adminName = $deptName = $pnt_ag_id = $ag_name = $pnt_quorum = $quorum_name = $pnt_typeAgenda = $pnt_charge_id = $pnt_flag_charge = $pnt_email = "";
			if(isset($qu_edit) && $qu_edit->num_rows()){
				// edit participant
				$arr_edt = get_pntByTypeAg($qu_edit, $arr_model, $flag_edit=1);
				if(!empty($arr_edt)){
					foreach($arr_edt as $key => $row){
						$pnt_id = $row["pnt_id"];
						$pnt_personId = $row["pnt_personId"];
						$pnt_op_id = $row["pnt_op_id"];
						$name = $row["pnt_name"];
						$pnt_adminId = $row["pnt_adminId"];
						$pnt_deptId = $row["pnt_deptId"];
						$pnt_dpId = $row["pnt_dpId"];
						$adminName = $row["pnt_adminName"];
						$deptName = $row["pnt_deptName"];
						$pnt_ag_id = $row["pnt_ag_id"];
						$ag_name = $row["pnt_ag_name"];
						$pnt_quorum = $row["pnt_quorum"];
						$quorum_name = $row["pnt_quorum_name"];
						$pnt_typeAgenda = $row["pnt_typeAgenda"];
						$pnt_charge_id = $row["pnt_charge_id"];
						$pnt_flag_charge = $row["pnt_flag_charge"];
						$pnt_email = $row["pnt_email"];
					}
				}
			}
		?>
		
		<?php
			echo form_open($this->config->item("emt_path").$actionForGroup,"frmType1");
		?>
<div id="da-panel collapsible" class="grid_4">
	<div class="da-panel collapsible">
		<div class="da-panel-header">
			<span class="da-panel-title">
				<img src="http://cvs.buu.ac.th/mispbri/css/emt_css/dandelion/HTML/images/icons/black/16/list.png">
				โดยกลุ่ม
			</span>
		</div>
		<div class="da-panel-content">
		<table style="width:100%;" align="center" class="da-table">
			<thead>
				<tr>
					<th>ชื่อกลุ่ม</th>
					<th width="300px;">ตำแหน่งในการประชุม</th>
					<th class="action" width="40px;"></th>
				</tr>
			</thead>
			<tbody>
				<?php 
				$rowPnt_type3 = "<tr class=\"type1\">";
					$rowPnt_type3 .= "<td style=\"padding-right:15px;\" >";
						$rowPnt_type3 .= "<select type=\"text\" class=\"validate\" style=\"width:100%;\" ";
						$rowPnt_type3 .= "title=\"กลุ่มผู้ประชุม\"  name=\"gp_id\" >";
							$rowPnt_type3 .= "<option value=\"\">-- เลือกกลุ่ม --</option>";
							foreach($rs_gp->result() as $row_gp){
								$rowPnt_type3 .= "<option value=\"{$row_gp->gp_id}\" >{$row_gp->gp_name}</option>";
							}
						$rowPnt_type3 .= "</select>";
					$rowPnt_type3 .="</td>";
					$rowPnt_type3 .= "<td>";
						$rowPnt_type3 .= "<select type=\"text\" class=\"validate\" ";
						$rowPnt_type3 .= "title=\"ตำแหน่งในการประชุม\"  name=\"pnt_ag_id\" >";
							$rowPnt_type3 .= "<option value=\"\">--โปรดเลือกตำแหน่งในการประชุม--</option>";
							foreach($rs_ag->result() as $row_ag){
								$rowPnt_type3 .= "<option value=\"{$row_ag->ag_id}\" >{$row_ag->ag_name}</option>";
							}
						$rowPnt_type3 .= "</select>";
						$rowPnt_type3 .= "<select name=\"pnt_quorum\">";
							$rowPnt_type3 .= "<option value=\"1\" >องค์ประชุม</option>";
							$rowPnt_type3 .= "<option value=\"0\" >ผู้เข้าร่วมประชุม</option>";
						$rowPnt_type3 .= "</select>";
					$rowPnt_type3 .= "</td>";
					$rowPnt_type3 .= "<td class=\"action\">";
						$rowPnt_type3 .= "<input type=\"hidden\" name=\"step\" value=\"2\" />";
						$rowPnt_type3 .= "<input type=\"hidden\" name=\"mt_id\" value=\"{$mt_id}\" />";
						$rowPnt_type3 .= "<input type=\"hidden\" name=\"cms_id\" value=\"{$cms_id}\" />";
						$rowPnt_type3 .= "<input type=\"submit\" name=\"submit_group\" value=\"บันทึก\" class=\"da-button green\" />";
					$rowPnt_type3 .= "</td>";
				$rowPnt_type3 .= "</tr>";
				echo $rowPnt_type3;
				?>
		</table>
		</div>
	</div>
</div>
		<?php
			echo form_close();
		?>
		
		<p>&nbsp;</p>

		<?php
			echo form_open($this->config->item("emt_path").$action,"frmType1");
		?>
<div id="da-panel collapsible" class="grid_4">
	<div class="da-panel collapsible">
		<div class="da-panel-header">
			<span class="da-panel-title">
				<img src="http://cvs.buu.ac.th/mispbri/css/emt_css/dandelion/HTML/images/icons/black/16/list.png">
				โดยชื่อ
			</span>
		</div>
		<div class="da-panel-content">
		<table style="width:100%;" align="center" class="da-table">
			<thead>
				<tr>
					<th>ชื่อ-นามสกุล </th>
					<th>ตำแหน่ง</th>
					<th>หน่วยงาน</th>
					<th width="280px;">ตำแหน่งในการประชุม</th>
					<th class="action" width="40px;"></th>
				</tr>
			</thead>
			<tbody>
				<?php 
					$edt_pnt_id = $edt_pnt_personId = $edt_pnt_op_id = $edt_name = $edt_pnt_adminId = $edt_pnt_deptId = $edt_pnt_dpId = $edt_adminName = $edt_deptName = $edt_pnt_email = "";
					$edt_ag_id = $edt_quorum_name = "";
					if($pnt_typeAgenda == 0){
						$edt_pnt_id = "value=\"{$pnt_id}\" ";
						$edt_pnt_personId = "value=\"{$pnt_personId}\" ";
						$edt_pnt_op_id = "value=\"{$pnt_op_id}\" ";
						$edt_name = "value=\"{$name}\" ";
						$edt_pnt_adminId = "value=\"{$pnt_adminId}\" ";
						$edt_adminName = "value=\"{$adminName}\" ";
						$edt_pnt_deptId = "value=\"{$pnt_deptId}\" ";
						$edt_pnt_dpId = "value=\"{$pnt_dpId}\" ";
						$edt_deptName = "value=\"{$deptName}\" ";
						$edt_ag_id = $pnt_ag_id;
						$edt_quorum_name = $quorum_name;
						$edt_pnt_email = "value=\"{$pnt_email}\" ";
					}

					$rowPnt_type1 = "<tr class=\"type1\">";
					$rowPnt_type1 .= "<td>";
					$rowPnt_type1 .= "<input type=\"hidden\" name=\"pnt_id\" {$edt_pnt_id} />";
					$rowPnt_type1 .= "<input type=\"hidden\" name=\"pnt_personId\" {$edt_pnt_personId} />";
					$rowPnt_type1 .= "<input type=\"hidden\" name=\"pnt_op_id\" {$edt_pnt_op_id} />";
					
					$rowPnt_type1 .= "<span href=\"\" class=\"subindex\" title=\"กรุณาพิมพ์ ชื่อ นามสกุล เพื่อค้นหารายชื่อในระบบ แล้วคลิกเลือกรายชื่อใน dropdrown ไม่เช่นนั้นจะเป็นบุคคลภายนอก\">";
					$rowPnt_type1 .= "<input type=\"text\" class=\"autocomplete validate\" ";
					$rowPnt_type1 .= "title=\"กรุณาพิมพ์ ชื่อ นามสกุล เพื่อค้นหารายชื่อในระบบ แล้วคลิกเลือกรายชื่อใน dropdrown ไม่เช่นนั้นจะเป็นบุคคลภายนอก\" get=\"getPerson\" name=\"personName\" {$edt_name} />"; //บุคลากร
					$rowPnt_type1 .= "</span>";	
					
					$rowPnt_type1 .= "</td>";
					$rowPnt_type1 .= "<td>";
					$rowPnt_type1 .= "<input type=\"hidden\" name=\"pnt_adminId\" {$edt_pnt_adminId} />";
					$rowPnt_type1 .= "<input type=\"hidden\" name=\"pnt_deptId\" {$edt_pnt_deptId} />";
					$rowPnt_type1 .= "<input type=\"text\" name=\"adminName\" {$edt_adminName} />";
					$rowPnt_type1 .= "</td>";
					$rowPnt_type1 .= "<td>";
					$rowPnt_type1 .= "<input type=\"hidden\" name=\"pnt_dpId\" {$edt_pnt_dpId} />";
					$rowPnt_type1 .= "<input type=\"text\" name=\"deptName\" {$edt_deptName} />";
					$rowPnt_type1 .= "</td>";
					$rowPnt_type1 .= "<td>";
					$rowPnt_type1 .= "<select type=\"text\" class=\"validate\" ";
					$rowPnt_type1 .= "get=\"getAgency\" name=\"pnt_ag_id\" >"; //ตำแหน่งในการประชุม
					$rowPnt_type1 .= "<option value=\"\">--โปรดเลือกตำแหน่งในการประชุม--</option>";
					foreach($rs_ag->result() as $row_ag){
						$selected = "";
						if($edt_ag_id == $row_ag->ag_id){
							// edit participant
							$selected = "selected=\"selected\" ";
						}
						$rowPnt_type1 .= "<option value=\"{$row_ag->ag_id}\" {$selected} >{$row_ag->ag_name}</option>";
					}
					$rowPnt_type1 .= "</select>";
					
					$qrm1 = $qrm0 = "";	// init
					if($edt_quorum_name == "องค์ประชุม"){
						$qrm1 = " selected=\"selected\" ";
					}
					else if($edt_quorum_name == "ผู้เข้าร่วมประชุม"){
						$qrm0 = " selected=\"selected\" ";
					}
					$rowPnt_type1 .= "<select name=\"pnt_quorum\">";
					$rowPnt_type1 .= "<option value=\"1\" {$qrm1} >องค์ประชุม</option>";
					$rowPnt_type1 .= "<option value=\"0\" {$qrm0} >ผู้เข้าร่วมประชุม</option>";
					$rowPnt_type1 .= "</select>";
					$rowPnt_type1 .= "<input type=\"hidden\" name=\"pnt_email\" {$edt_pnt_email}/>";
					$rowPnt_type1 .= "</td>";
					$rowPnt_type1 .= "<td class=\"action\">";
					$rowPnt_type1 .= "<input type=\"hidden\" name=\"step\" value=\"2\" />";
					$rowPnt_type1 .= "<input type=\"hidden\" name=\"mt_id\" value=\"{$mt_id}\" />";
					$rowPnt_type1 .= "<input type=\"hidden\" name=\"cms_id\" value=\"{$cms_id}\" />";
					$rowPnt_type1 .= "<input type=\"hidden\" name=\"pnt_typeAgenda\" value=\"0\" />";
					$rowPnt_type1 .= "<input type=\"submit\" name=\"submit\" value=\"บันทึก\"  class=\"da-button green\"/>";
					//$rowPnt_type1 .= "<a href=\"javascript:void(0);\" id=\"pntSave1\">{$img_save}</a>";
					$rowPnt_type1 .= "</td>";
					$rowPnt_type1 .= "</tr>";
					echo $rowPnt_type1;
				?>
			</tbody>
		</table>
		</div>
	</div>
</div>
		<?php
			echo form_close();
		?>
		
		<!--<p>&nbsp;</p>-->
		
		<?php
		/*
			//-- 2013-04-01 meuzicxx โครงสร้างยังไม่เรียบร้อย
			echo form_open($this->config->item("emt_path").$action,"frmType2");
		?>
		<div style="padding-left:15px;">
			<h4>โดยตำแหน่ง</h4>
		</div>
		<table style="width:95%;" align="center" class="emt_table">
			<thead>
				<tr>
					<th>ตำแหน่ง</th>
					<th>ชื่อ-นามสกุล</th>
					<th >หน่วยงาน</th>
					<th width="260px;">ตำแหน่งในการประชุม</th>
					<th class="action" width="40px;"></th>
				</tr>
			</thead>
			<tbody>
				<?php
					$edt_pnt_id = $edt_pnt_adminId = $edt_adminName = $edt_pnt_personId = $edt_pnt_op_id = $edt_name = $edt_pnt_deptId = $edt_deptName = $edt_pnt_email = "";
					$edt_ag_id = $edt_quorum_name = "";
					if($pnt_typeAgenda == 1){
						$edt_pnt_id = "value=\"{$pnt_id}\" ";
						$edt_pnt_adminId = "value=\"{$pnt_adminId}\" ";
						$edt_adminName = "value=\"{$adminName}\" ";
						$edt_pnt_personId = "value=\"{$pnt_personId}\" ";
						$edt_pnt_op_id = "value=\"{$pnt_op_id}\" ";
						$edt_name = "value=\"{$name}\" ";
						$edt_pnt_deptId = "value=\"{$pnt_deptId}\" ";
						$edt_deptName = "value=\"{$deptName}\" ";
						$edt_ag_id = $pnt_ag_id;
						$edt_quorum_name = $quorum_name;
						$edt_pnt_email = "value=\"{$pnt_email}\" ";
					}

					$rowPnt_type2 = "<tr class=\"type2\">";
					$rowPnt_type2 .= "<td>";
					$rowPnt_type2 .= "<input type=\"hidden\" name=\"pnt_id\" {$edt_pnt_id} />";
					$rowPnt_type2 .= "<input type=\"hidden\" name=\"pnt_adminId\" {$edt_pnt_adminId} />";
					$rowPnt_type2 .= "<input type=\"text\" class=\"autocomplete  validate\" ";
					$rowPnt_type2 .= "title=\"ตำแหน่งทางวิชาการ\"  get=\"getAdmin\" name=\"adminName\" {$edt_adminName} />";
					$rowPnt_type2 .= "</td>";
					$rowPnt_type2 .= "<td>";	
					$rowPnt_type2 .= "<input type=\"hidden\" name=\"pnt_personId\" {$edt_pnt_personId} />";
					$rowPnt_type2 .= "<input type=\"hidden\" name=\"pnt_op_id\" {$edt_pnt_op_id} />";
					$rowPnt_type2 .= "<input type=\"text\" name=\"personName\" {$edt_name} />";
					$rowPnt_type2 .= "</td>";
					$rowPnt_type2 .= "<td>";
					$rowPnt_type2 .= "<input type=\"hidden\" name=\"pnt_deptId\" {$edt_pnt_deptId} />";
					$rowPnt_type2 .= "<input type=\"text\" name=\"deptName\" {$edt_deptName} />";
					$rowPnt_type2 .= "</td>";
					$rowPnt_type2 .= "<td>";
					$rowPnt_type2 .= "<select type=\"text\" class=\"validate\" ";
					$rowPnt_type2 .= "title=\"ตำแหน่งในการประชุม\" get=\"getAgency\" name=\"pnt_ag_id\" >";
					$rowPnt_type2 .= "<option value=\"\">--โปรดเลือกตำแหน่งในการประชุม--</option>";
					foreach($rs_ag->result() as $row_ag){
						$selected = "";
						if($edt_ag_id == $row_ag->ag_id){
							// edit participant
							$selected = "selected=\"selected\" ";
						}
						$rowPnt_type2 .= "<option value=\"{$row_ag->ag_id}\" {$selected} >{$row_ag->ag_name}</option>";
					}
					$rowPnt_type2 .= "</select>";
					
					$qrm1 = $qrm0 = "";	// init
					if($edt_quorum_name == "องค์ประชุม"){
						$qrm1 = " selected=\"selected\" ";
					}
					else if($edt_quorum_name == "ผู้เข้าร่วมประชุม"){
						$qrm0 = " selected=\"selected\" ";
					}
					$rowPnt_type2 .= "<select name=\"pnt_quorum\">";
					$rowPnt_type2 .= "<option value=\"1\" {$qrm1} >องค์ประชุม</option>";
					$rowPnt_type2 .= "<option value=\"0\" {$qrm0} >ผู้เข้าร่วมประชุม</option>";
					$rowPnt_type2 .= "</select>";
					$rowPnt_type2 .= "<input type=\"hidden\" name=\"pnt_email\" {$edt_pnt_email} />";
					$rowPnt_type2 .= "</td>";
					$rowPnt_type2 .= "<td class=\"action\">";
					$rowPnt_type2 .= "<input type=\"hidden\" name=\"step\" value=\"2\" />";
					$rowPnt_type2 .= "<input type=\"hidden\" name=\"mt_id\" value=\"{$mt_id}\" />";
					$rowPnt_type2 .= "<input type=\"hidden\" name=\"cms_id\" value=\"{$cms_id}\" />";
					$rowPnt_type2 .= "<input type=\"hidden\" name=\"pnt_typeAgenda\" value=\"1\" />";
					$rowPnt_type2 .= "<input type=\"submit\" name=\"submit\" value=\"บันทึก\"  class=\"da-button green\"/>";
					//$rowPnt_type2 .= "<a href=\"javascript:void(0);\" id=\"pntSave2\">{$img_save}</a>";
					$rowPnt_type2 .= "</td>";
					$rowPnt_type2 .= "</tr>";
					echo $rowPnt_type2;
				?>
			</tbody>
		</table>
		<?php
			echo form_close();
			*/
		?>
		
		<p>&nbsp;</p>
<div id="da-panel collapsible" class="grid_4">
	<div class="da-panel collapsible">
		<div class="da-panel-header">
			<span class="da-panel-title">
				<img src="http://cvs.buu.ac.th/mispbri/css/emt_css/dandelion/HTML/images/icons/black/16/list.png">
				รายชื่อบุคลากรในการประชุม
			</span>
		</div>
		<div class="da-panel-content">
		<table style="width:100%;" align="center" class="da-table" id="close_ok">
			<thead>
				<tr>
					<th>บุคลากรในการประชุม</th>
					<th width="150px;">หน่วยงาน</th>
					<th colspan="2">ตำแหน่งในการประชุม</th>
					<th class="action" width="80px;" >ดำเนินการ&nbsp;<input type="checkbox" name="chk_all" id="chk_all" onclick="chkList(this.checked,'BB')" /></th>
					
				</tr>
			</thead>
			<tbody class="sortable">
				<?php
					$arr_pnt_ag = array();
					if(isset($arr_pnt) && !empty($arr_pnt)){
						$i = 0;
						foreach($arr_pnt as $key => $value){
							$pnt_id = $value["pnt_id"];
							$name = $value["pnt_name"];
							$pnt_adminId = $value["pnt_adminId"];
							$adminName = $value["pnt_adminName"];
							$deptName = $value["pnt_deptName"];
							$ag_name = $value["pnt_ag_name"];
							$quorum_name = $value["pnt_quorum_name"];
							$pnt_typeAgenda = $value["pnt_typeAgenda"];
							$pnt_charge_id = $value["pnt_charge_id"];
							$pnt_flag_charge = $value["pnt_flag_charge"];
							$pnt_op_id = $value["pnt_op_id"];
							
							// to check agency
							$arr_pnt_ag[$i] = $value["pnt_ag_id"];
							
							// get child charge
							$chrg_id = $chrg_name = $chrg_adminId = $chrg_adminName = $chrg_deptName = $chrg_ag_name = $chrg_quorum_name = $chrg_typeAgenda = $chrg_flag_charge = "";
							if($pnt_charge_id){
								$arr_chrg = get_arrPnt(null, $pnt_charge_id, $arr_model, $cond="", $flag_edit=0);
								if(!empty($arr_chrg)){
									foreach($arr_chrg as $chrg_key => $chrg_val){
										$chrg_id = $chrg_val["pnt_id"];
										$chrg_name = $chrg_val["pnt_name"];
										$chrg_adminId = $chrg_val["pnt_adminId"];
										$chrg_adminName = $chrg_val["pnt_adminName"];
										$chrg_deptName = $chrg_val["pnt_deptName"];
										$chrg_ag_name = $chrg_val["pnt_ag_name"];
										$chrg_quorum_name = $chrg_val["pnt_quorum_name"];
										$chrg_typeAgenda = $chrg_val["pnt_typeAgenda"];
										$chrg_flag_charge = $chrg_val["pnt_flag_charge"];
									}
								}
							}
							
							$pnt_parent_id = $pnt_id;
							$pnt_parent_adminId = $pnt_adminId;
							
							$rowPnt = "<tr id=\"{$pnt_parent_id}\">";
							$rowPnt .= "<td>";
							if($pnt_typeAgenda == 0){
								// โดยชื่อ
								$rowPnt .= $name;
								if($pnt_parent_adminId != 0 && $adminName != ""){
									$rowPnt .= " (".$adminName.")";
								}
								$warnMsg = $name;
								// charge
								if($chrg_id){
									$rowPnt .= "<br/>";
									$rowPnt .= "<comment style=\"padding-left:0px;\" >[ {$chrg_name} ({$chrg_adminName}) ]</comment>";
								}
							}
							/*
							//-- 2013-04-01 meuzicxx โครงสร้างยังไม่เรียบร้อย
							else{
								// โดยตำแหน่ง
								$rowPnt .= $adminName." (".$name.")";
								$warnMsg = $adminName;
								// charge
								if($chrg_id){
									$rowPnt .= "<br/>";
									$rowPnt .= "<comment style=\"padding-left:0px;\" >[ {$chrg_adminName} ({$chrg_name}) ]</comment>";
								}
							}*/
							if($pnt_op_id != NULL){
								$rowPnt .= "<span class=\"red\"> *</span>";
							}
							$rowPnt .= "</td>";
							$rowPnt .= "<td width=\"25%\">".$deptName."</td>";
							$rowPnt .= "<td nowrap=\"nowrap\" >".$ag_name."</td>";
							$rowPnt .= "<td nowrap=\"nowrap\" >".$quorum_name."</td>";
							$rowPnt .= "<td class=\"action\" >";
							/*
							//-- 2013-04-01 meuzicxx โครงสร้างยังไม่เรียบร้อย
							if($pnt_parent_adminId != 0){
								$rowPnt .= "<a href=\"javascript:void(0);\" class=\"pntCharge\" style=\"margin:3px;\" title=\"รักษาการแทน\" onclick=\"pntCharge('{$pnt_id}')\" >".$imgCharge."</a>";
							}
							*/
							$rowPnt .= "<a href=\"javascript:void(0);\" class=\"pntEdit\" style=\"margin:3px;\" title=\"แก้ไขบุคลากรในการประชุม\" onclick=\"pntEdit('{$pnt_id}')\" >".$imgEdit."</a>";
							$rowPnt .= "<a href=\"javascript:void(0);\" class=\"pntDel\" title=\"ลบบุคลากรในการประชุม\" onclick=\"pntDel('{$pnt_id}','{$warnMsg}')\" >".$imgDel."</a>";
							//egoist------------------
							$actions = "emeeting/emeeting/emeetingAdd";
							?> <form id="frm1" method="post" action="<?php $actions ?> "> <?php
							$rowPnt .= "<input class=\"BB\" type=\"checkbox\" name=\"person[]\" value=\"".$pnt_id."\" />";?>
							<input type="hidden" name="step" value="2" />
							<input type="hidden" name="mt_id" value="<?php echo $mt_id; ?>" />
							<input type="hidden" name="cms_id" value="<?php echo $cms_id; ?>" />
							<?php
							//egosit-------------------------
							$rowPnt .= "</td>";
							$rowPnt .= "</tr>";
							echo $rowPnt;
							$i++;
						}
					}
					else { 
						echo "<tr><td colspan='5' align='center' class='red'>" . $this->config->item("emt_not_found") . "</td></tr>";
					}
				?>
			</tbody>
		</table>
		<!--egoist--->
		<?php
		//if(isset($arr_pnt)&&$arr_pnt->num_rows > 0){
		?>
		<div align="center" style="padding:25px;">
		<input type="submit" name="del" value="ลบที่เลือก"/>
		</div>
		</form>
		<?php //}  ?>
		<!--egoist--->
		</div>
	</div>
</div>
		
		<div style="padding-left:25px;">
			</br>
			<b>หมายเหตุ</b>: <span class="error">*</span> หมายถึง เป็นบุคลากรภายนอก
		</div>
		
		<div align="right" style="width:100%;margin-top:25px;">
			<fieldset style="width:30%;margin-right:25px;text-align:left;">
				<comment>
					หน้าที่ในการประชุมที่สามารถจัดการประชุมได้มีดังนี้
					<ul>
						<?php 
						foreach($rs_ag->result() as $row_ag){
							if($row_ag->ag_manage != 1){
								continue;
							}
							$ag_ok[] = $row_ag->ag_id;
							echo "<li> - {$row_ag->ag_name}</li>";
						}
						?>
					</ul>
				</comment>
			</fieldset>
		</div>
		
		<p>&nbsp;</p>
		<!--
		<?php /*
			if(isset($opt_pnt) && !empty($opt_pnt)){
				// Form
				echo form_open($this->config->item("emt_path").$action,"frmLastPnt");
					?>
					<h3>กำหนดผู้รับผิดชอบการประชุม</h3>
					<div style="margin-left:25px; padding:10px 20px; border:1px solid #ccc; width:50%;">
						<label style="display:inline-block;width:150px;">ผู้พิมพ์รายงานการประชุม</label>
						<?php
							echo form_dropdown("lastPaticipant1", $opt_pnt, $rs_lastPnt->row()->lastPaticipant1,'id="lastPaticipant1"'); 
						?>
						<br/>
						<label style="display:inline-block;width:150px;">ผู้จดรายงานการประชุม</label>
						<?php
							echo form_dropdown("lastPaticipant2", $opt_pnt, $rs_lastPnt->row()->lastPaticipant2,'id="lastPaticipant2"'); 
						?>
						<br/>
						<label style="display:inline-block;width:150px;">ผู้จดรายงานการประชุม</label>
						<?php
							echo form_dropdown("lastPaticipant3", $opt_pnt, $rs_lastPnt->row()->lastPaticipant3,'id="lastPaticipant3"'); 
						?>
						<br/>
						<label style="display:inline-block;width:150px;">ผู้ตรวจรายงานการประชุม</label>
						<?php
							echo form_dropdown("lastPaticipant4", $opt_pnt, $rs_lastPnt->row()->lastPaticipant4,'id="lastPaticipant4"'); 
						?>
					</div>
					<div style="padding-left:200px;">
						<input type="hidden" name="step" value="2" />
						<input type="hidden" name="mt_id" value="<?php echo $mt_id; ?>" />
						<input type="hidden" name="cms_id" value="<?php echo $cms_id; ?>" />
						<?php
							echo "<input type=\"submit\" class=\"da-button green\" name=\"btnsubmitLast\" value=\"บันทึก\" />";
						*/?>
					</div>-->
					<?php
				// Close Form
			//	echo form_close();
		//	}
		
			if(isset($flag) && $flag == "continue"){
				// Form
				echo form_open($this->config->item("emt_path").$action,"frmNext");
					?>
					<br/><br/>
					<div align="center">
						<input type="hidden" name="mt_id" value="<?php echo $mt_id; ?>" />
						<input type="hidden" name="cms_id" value="<?php echo $cms_id; ?>" />
						<?php
						if( $status != "edit" ){
							echo "<input type=\"submit\" class=\"da-button blue\" name=\"btnnextto3\" value=\"ถัดไป  >\"  style=\"width:150px;\" />";
						}
						?>
					</div>
					<?php
				// Close Form
				echo form_close();
			}
		?>
		
		<script>
			ag_ok = <?php echo json_encode($ag_ok); ?>;
			arr_pnt_ag = <?php echo json_encode($arr_pnt_ag); ?>;
		</script>
					</div>
			</div>
		</div>
	</div>
	<div><span style="padding-right:130px;">&nbsp;</span> </div>