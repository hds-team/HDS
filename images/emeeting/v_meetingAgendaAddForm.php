<!-- fancybox --><script type="text/javascript" src="<?php echo base_url(); ?>js/emt_js/fancybox.js"></script><?php echo link_tag('css/emt_css/fancybox/fancybox.css');if(isset($rs_cms)){	$row_cms = $rs_cms->row();	$cms_id = $row_cms->cms_id;}else{	echo "<div style=\"text-align:center;padding:10px;margin10px;color:#FF0000;\"><h3>ไม่พบรหัสการประชุมหลัก กรุณาเข้าเมนูนี้ใหม่อีกครั้ง!</h3></div>";}if(isset($rs_mt)){	$row = $rs_mt->row();	$mt_id = $row->mt_id;	$mts_id = $row->mt_mts_id;}else{	echo "<div style=\"text-align:center;padding:10px;margin10px;color:#FF0000;\"><h3>ไม่พบรหัสการประชุม กรุณาเข้าเมนูนี้ใหม่อีกครั้ง!</h3></div>";}$num_th = $this->config->item('emt_cv_th');	?><script language="javascript">$(document).ready(function(){		//Add event	$("#back").click(back);		//Function	function back(){		url = site_url+"announceMeeting/announceMeetingShow";		sendPost("frmMt",{"flag":1, "detail":2}, url, "", "")	}		});function callfancyboxAdd(agdt_id, getAdd){	$.fancybox({		'height' 			: '98%',		'width' 			: '95%',		'transitionIn'		: 'none',		'transitionOut'		: 'none',		'type'				: 'iframe',		'href'				: site_url+"agenda/agendaAdd/"+getAdd,		'onClosed'			: function() {								url = site_url+"announceMeeting/meetingDetail/#"+agdt_id;								sendPost("frm", {"mt_id":<?php echo $mt_id; ?>, "cms_id":<?php echo $cms_id; ?>, "flag":"add"}, url, "", "");							}	});}function callfancyboxEdit(agdt_id, getEdit){	$.fancybox({		'height' 			: '98%',		'width' 			: '95%',		'transitionIn'		: 'none',		'transitionOut'		: 'none',		'type'				: 'iframe',		'href'				: site_url+"agenda/agendaEdit/"+getEdit,		'onClosed'			: function() {								url = site_url+"announceMeeting/meetingDetail/#"+agdt_id;								sendPost("frm", {"mt_id":<?php echo $mt_id; ?>, "cms_id":<?php echo $cms_id; ?>, "flag":"add"}, url, "", "");							}	});}function agdtDel(agdt_id, msg){		if(!confirm("คุณต้องการลบ \""+msg+"\" ใช่หรือไม่")){			return false;		}		var url = "<?php echo site_url() . "emeeting/agenda/agdtDel"; ?>";		var obj = this;		$.post(url,{agdt_id:agdt_id},function(data){			if(data=="ok"){				url = site_url+"announceMeeting/meetingDetail";				sendPost("reload", {"mt_id":<?php echo $mt_id; ?>,"cms_id":<?php echo $cms_id; ?>, "flag":"add"}, url, "", "")			}		});	}	</script><style>	.sortable{		margin : 0px;		padding : 0px;	}	.sortable li{		line-height : 20px;		list-style: none;		margin : 0px;		padding : 0px;		padding-left : 20px;		border : 1px solid #FFFFFF;	}	.sortable>li:hover{		border : 1px solid #D0DCF0;	}	.sortable li.ui-state-highlight { 		height : 30px;		line-height : 30px;		background : #D0DCF0;	}	li.ui-sortable-helper{		border : 1px solid #fad42e;		background: #FAFAFA;	}	li .sortable{		padding-left : 35px;	}	.string {		display : inline-block;		width : 90%;	}	.icon32,.icon{		cursor : pointer;	}	h4#meeting{		margin : 0 10px;	}	h3 a{		text-decoration:none;		color : #555;	}</style><?php// Bodyif(isset($rs_cms) && isset($rs_mt)){?>		<?php		$back = array(			"src" => "images/emeeting/icons/back.png"		);		$imgBack = img($back);		echo "<a class=\"icon\" id=\"back\">{$imgBack}</a>";		?>		<?php			$mt_mts_id = $rs_mt->row()->mt_mts_id;		?>		<div class="grid_4_center">        <div class="da-panel">            <div class="da-panel-header">                <span class="da-panel-title">				<img src=<?php echo base_url().$this->config->item("emt_dandelion_folder")."images/icons/black/32/list.png";?> />                                    ชื่อการประชุม : 				<?php				echo $row_cms->cms_name;				?>				ครั้งที่ <?php echo al_to_th($rs_mt->row()->mt_no); ?> / <?php echo  al_to_th($rs_mt->row()->mt_year); ?>			                </span>          </div>	 <div class="da-panel-content">		<table style="width:100%;" align="center" class="da-table" >			<tbody>				<tr>					<td colspan="2" style="background-color:#C2CFDF;"><b>รายละเอียดการประชุม</b>					</td>				</tr>				<tr>					<td width="200"><label>ชื่อการประชุม : </label></td>					<td>						<?php echo emt_getval("cms_name", $row_cms);?>					</td>				</tr>				<tr>					<td><label>ครั้งที่ : </label></td>					<td>						<?php echo al_to_th(emt_getval("mt_no", $row));?> / <?php echo al_to_th(emt_getval("mt_year", $row));?>					</td>				</tr>				<tr>					<td>						<label>รูปแบบการประชุม : </label>					</td>					<td>						<?php						if(emt_getval("cms_type", $row_cms)){							$str = "การประชุมส่วนตัว ";						} else {							$str = "การประชุมไม่ส่วนตัว ";						}						echo $str;						?>					</td>				</tr>				<tr>					<td>						<label>ประเภทการประชุม : </label>					</td>					<td>						<?php echo emt_getval("mtt_name", $row);?>					</td>				</tr>				<tr>					<td><label>ประจำปี : </label></td>					<td>						<?php						if(emt_getval("cms_year_type", $row_cms) == 1){							$str = "ตามปีปฎิทิน";						} else {							$str = "ตามปีงบประมาณ";						}						echo $str . " " . al_to_th(emt_getval("cms_year", $row_cms));						?>					</td>				</tr>				<tr>					<td><label>จากวันที่ : </label></td>					<td>						<?php						if(emt_getval("mt_date_start", $row)==1){							$str = "ไม่ระบุ";						} else {							$str = $num_th(dateDisplay(emt_getval("mt_date_start", $row)));						}						echo $str;						?>					</td>				</tr>				<tr>					<td><label>ถึงวันที่ : </label></td>					<td>						<?php						if(emt_getval("mt_date_stop", $row)==1){							$str = "ไม่ระบุ";						} else {							$str = $num_th(dateDisplay(emt_getval("mt_date_stop", $row)));						}						echo $str;						?>					</td>				</tr>				<tr>					<td><label>เวลา : </label></td>					<td>						<?php 						$mt_start_time = emt_getval("mt_start_time", $row);						$tmp = explode(":", $mt_start_time);						$mt_start_time = $tmp[0] . "." . $tmp[1];						$mt_end_time = emt_getval("mt_end_time", $row);						$tmp = explode(":", $mt_end_time);						$mt_end_time = $tmp[0] . "." . $tmp[1];						echo $num_th($mt_start_time . " - " . $mt_end_time)."  น.";						?>					</td>				</tr>				<?php				$mt_placeName = emt_getval("mt_placeName", $row);				$mt_placeDetail = emt_getval("mt_placeDetail", $row);				if($mt_placeName!="" OR $mt_placeDetail!=""){				?>				<tr>					<td><label>สถานที่ประชุม : </label></td>					<td>						<?php						$mt_placeDetail = ($mt_placeDetail != '') ? "ห้องประชุม ".$mt_placeDetail : '';						echo $num_th($mt_placeName . " " . $mt_placeDetail);						?>					</td>				</tr>				<?php				}				?>			</tbody>		</table>		<br/>		<table style="width:100%;" align="center" class="da-table" >			<tbody>				<tr>					<td colspan="3" style="background-color:#C2CFDF;"><b>บุคลากรที่มีสิทธิ์ในการจัดการประชุม</b>					</td>				</tr>				<?php					if(isset($arr_pnt) && !empty($arr_pnt)){						$i = 0;						foreach($arr_pnt as $key => $value){							$pnt_id = $value["pnt_id"];							$pnt_parent_id = $value["pnt_parent_id"];							$pnt_parent_adminId = $value["pnt_parent_adminId"];							$pnt_parent_typeAgenda = $value["pnt_parent_typeAgenda"];							$name = $value["pnt_name"];							$adminName = $value["pnt_adminName"];							$ag_name = $value["pnt_ag_name"];							$ag_manage = $value["pnt_ag_manage"];														if($ag_manage == 0){								continue;							}							$i++;														$rowPnt = "<tr>";							$rowPnt .= "<td width=\"50\" align=\"center\">" . al_to_th($i) . "</td>";							if($pnt_parent_typeAgenda == 0){								// โดยชื่อ								$rowPnt .= "<td style=\"padding-left:10px;\" >";								$rowPnt .= $name;								if($pnt_parent_adminId != 0 && $adminName != ""){									$rowPnt .= " (".$adminName.")";								}								$rowPnt .= "</td>";							}							else{								// โดยตำแหน่ง								$rowPnt .= "<td style=\"padding-left:10px;\" >".$adminName." (".$name.")";								$rowPnt .= "</td>";							}							$rowPnt .= "<td width=\"150\" align=\"right\" style=\"padding-right:10px;\" >{$ag_name}</td>";							$rowPnt .= "</tr>";							echo $rowPnt;						}					}				?>			</tbody>		</table>		<br/>		<table style="width:100%;" align="center" class="da-table" >			<tbody>				<tr>					<td colspan="3" style="background-color:#C2CFDF;"><b>บุคลากรในการประชุม</b>					</td>				</tr>				<?php					if(isset($arr_pnt) && !empty($arr_pnt)){						$i = 0;						foreach($arr_pnt as $key => $value){							$pnt_id = $value["pnt_id"];							$pnt_parent_id = $value["pnt_parent_id"];							$pnt_parent_adminId = $value["pnt_parent_adminId"];							$pnt_parent_typeAgenda = $value["pnt_parent_typeAgenda"];							$name = $value["pnt_name"];							$adminName = $value["pnt_adminName"];							$ag_name = $value["pnt_ag_name"];														$i++;														$rowPnt = "<tr>";							$rowPnt .= "<td width=\"50\" align=\"center\">" . al_to_th($i) . "</td>";							if($pnt_parent_typeAgenda == 0){								// โดยชื่อ								$rowPnt .= "<td style=\"padding-left:10px;\" >";								$rowPnt .= $name;								if($pnt_parent_adminId != 0 && $adminName != ""){									$rowPnt .= " (".$adminName.")";								}								$rowPnt .= "</td>";							}							else{								// โดยตำแหน่ง								$rowPnt .= "<td style=\"padding-left:10px;\" >".$adminName." (".$name.")";								$rowPnt .= "</td>";							}							$rowPnt .= "<td width=\"150\" align=\"right\" style=\"padding-right:10px;\" >{$ag_name}</td>";							$rowPnt .= "</tr>";							echo $rowPnt;						}					}				?>			</tbody>		</table>		<br/>		<table style="width:100%;" align="center" class="da-table" >			<tbody>				<tr>					<td colspan="3" style="background-color:#C2CFDF;"><b>ระเบียบวาระในการประชุม</b>					</td>				</tr>				<tr>					<td id="body_agtp">						<ul class="sortable">							<?php								if($mts_id >= 23 && $mts_id <= 24)								{									// เสนอวาระเพิ่มเติม									$ck_edit = "approve";									re_viewAgdtAdd($rs_agdt, 0, $ck_edit, $cms_id, $rs_file, $psId, $mts_id);								}								else								{									// แสดงวาระปกติ									re_viewAgdt($rs_agdt, 0, $rs_file);								}							?>						</ul>					</td>				</tr>				<tr>					<td></td>				</tr>			</tbody>		</table>		<p>&nbsp;</p>		<?php if(isset($agdt_edit) && $agdt_edit != "") { ?>		<fieldset style="border:1px solid #FF0000">			<legend><b>จากการรับรองวาระการประชุม มีสิ่งที่ต้องแก้ไขดังนี้ :</b></legend>			<?php				echo $agdt_edit;			?>		</fieldset>		<?php } ?>	</div></div></div><?php}// End body?><?phpfunction re_viewAgdtAdd($child, $no=0, $ck_edit=0, $cms_id, $rs_file, $psId, $mts_id){	$str_agd = "วาระที่ ";	$str_detail = "รายละเอียด";	$str_by = "เสนอโดย";	$str_present = "ประเด็นเสนอ";	$str_result = "มติ";	$str_edit = "สิ่งที่ต้องแก้ไข";	$str_file = "เอกสารแนบ";	$no_send = "";		// Image add	$add = array(		"src" => "images/emeeting/icons/add.png",		"width" => "16",		"border" => "0"	);	$imgAdd= img($add);		// Image edit	$edit = array(		"src" => "images/emeeting/icons/edit.png",		"width" => "16",		"border" => "0"	);	$imgEdit = img($edit);		// Image Delete	$del = array(		"src" => "images/emeeting/icons/del.png",		"width" => "16",		"border" => "0"	);	$imgDel = img($del);			// Image OK	$ok = array(		"src" => "images/emeeting/yes.png",		"width" => "16",		"border" => "0"	);	$imgOK = img($ok);		// Image Cancel	$cancel = array(		"src" => "images/emeeting/dialog_cancel.png",		"width" => "16",		"border" => "0"	);	$imgCancel = img($cancel);		?>	<ul class="sortable" >		<?php		$i = 0;		foreach($child->result() as $row_child){			/*if($row_child->agdt_add == '1' && $row_child->agdt_personId != $psId && $row_child->agdt_flag_appv != 'Y'){				// cannot manage this agenda 				continue;			}*/		?>		<li id="<?php echo $row_child->agdt_id; ?>" name="<?php echo $row_child->agdt_id; ?>">			<?php 			echo "<span class=\"string\" id=\"agdt_".$row_child->agdt_id."\" style=\"float:left;\"><div class=\"tbin\">";						$i = $i + 1;			if($row_child->agdt_level == 0){				echo "<b>".$str_agd . al_to_th($i) . "</b>&nbsp;&nbsp;&nbsp;";				$no_send = $i;				$agdt_no = $i;			} else {				echo "<b>".al_to_th($no) . "." . al_to_th($i) . "</b>&nbsp;&nbsp;&nbsp;";				$no_send = $no . "." . $i;				$agdt_no = $no . "." . $i;			}						echo "<b>".$row_child->agdt_head."</b><br/>";						if($row_child->agdt_detail != "")			{				echo $row_child->agdt_detail;			}			else			{				echo "<br/>";			}						//	เสนอโดย			if($row_child->agdt_by)			{				echo "<b><u>".$str_by."</u></b>&nbsp;&nbsp;".$row_child->agdt_by."<br/><br/>";			}						// File			$ag_file = $rs_file->getFileByAgdtId($row_child->agdt_id);						if($ag_file->num_rows() > 0){				echo "<b><u>".$str_file."</u></b>";				echo "<ul>";				foreach($ag_file->result() as $row_file)				{					echo '<li><a href="'.base_url().'uploads/emeeting/docs/'.$row_file->agfl_nname.'" target="_blank" >- '.$row_file->agfl_oname.'</a></li>';				}				echo "</ul><br/>";			}						// Present			if($row_child->agdt_present != "")			{				echo "<b><u>".$str_present."</u></b>";				echo $row_child->agdt_present;			}						// ผลการอนุมัติวาระเพิ่มเติม			if($mts_id <= 24){				if($row_child->agdt_add == '1' && ($row_child->agdt_flag_appv == 'Y' || $row_child->agdt_flag_appv == 'N') && $row_child->agdt_personId == $psId)				{					if($row_child->agdt_flag_appv == 'Y'){						$ok2 = "style=\"color:green;\"";						$cancel2 = "style=\"display:none;\"";					}					else{						$cancel2 = "style=\"color:red;\"";						$ok2 = "style=\"display:none;\"";					}															$agdt_appv_note = $row_child->agdt_appv_note;					if($agdt_appv_note){						$closeInput = "";					}					else{						$closeInput = "style=\"display:none;\"";					}										?>					<br/><div style="width:760px;border:1px solid #D0DCF0;background:#EEF2F7;padding:5px 5px 5px 5px;">						<span class="ok2_<?php echo $row_child->agdt_id; ?>" <?php echo $ok2; ?> ><?php echo $imgOK; ?>&nbsp;อนุมัติแล้ว</span>						<span class="cancel2_<?php echo $row_child->agdt_id; ?>" <?php echo $cancel2; ?> ><?php echo $imgCancel; ?>&nbsp;ไม่อนุมัติ</span>						<span class="showInput_<?php echo $row_child->agdt_id; ?>" <?php echo $closeInput; ?> >&nbsp;&nbsp;&nbsp;<b>หมายเหตุ : </b>							<input type="text" name="notelist_<?php echo $row_child->agdt_id; ?>" class="notelist_<?php echo $row_child->agdt_id; ?>" value="<?php echo $agdt_appv_note; ?>" style="width:300;" disabled="disabled">						</span>					</div><br/>					<?php				}			}						echo "</div></span>";			if($mts_id < 24){				$agdt_personId = $psId;				$flag_agdt_add = 1;				$no_parent = $no_ag = $no_send;								$getAdd = $row_child->agdt_id."/".($row_child->agdt_level+1)."/".$row_child->agdt_mt_id."/".$cms_id."/".$flag_agdt_add."/".$agdt_personId."/".$no_parent;				$getEdit = $row_child->agdt_id."/".$row_child->agdt_level."/".$row_child->agdt_mt_id."/".$cms_id."/".$flag_agdt_add."/".$agdt_personId."/".$no_ag."/-1/-1";				?>				<div style="float:right;margin:3px;height:18px;width:nowrap;">					<a href="javascript:void(0);" class="agdtAdd" title="เพิ่มระเบียบวาระ" onclick="callfancyboxAdd('<?php echo $row_child->agdt_id; ?>','<?php echo $getAdd; ?>')" ><?php echo $imgAdd; ?></a>					<?php if($row_child->agdt_add == '1' && $row_child->agdt_flag_appv != 'Y' && $row_child->agdt_personId == $psId){ ?>						<a href="javascript:void(0);" class="agdtEdit" title="แก้ไขระเบียบวาระ" onclick="callfancyboxEdit('<?php echo $row_child->agdt_id; ?>','<?php echo $getEdit; ?>')" ><?php echo $imgEdit; ?></a>						<a href="javascript:void(0);" class="agdtDel" title="ลบระเบียบวาระ" onclick="agdtDel('<?php echo $row_child->agdt_id ?>','<?php echo "วาระที่&nbsp;".$no_send."&nbsp;".$row_child->agdt_head ?>')"><?php echo $imgDel; ?></a>					<?php } ?>				</div>				<br style="clear:both; line-height:0; height:0; font-size: 1px;" />			<?php			}			if($row_child->child->num_rows()>0){				re_viewAgdtAdd($row_child->child, $no_send, $ck_edit, $cms_id, $rs_file, $psId, $mts_id);			} 			?>		</li>		<?php			if($row_child->agdt_level == 0){				echo "<hr />";			}		}		?>	</ul><?php}function re_viewAgdt($child, $no=0, $rs_file){	$str_agd = "วาระที่ ";	$str_detail = "รายละเอียด";	$str_by = "เสนอโดย";	$str_present = "ประเด็นเสนอ";	$str_result = "มติ";	$str_edit = "สิ่งที่ต้องแก้ไข";	$str_file = "เอกสารแนบ";	$no_send = "";		?>	<ul class="sortable" >		<?php		$i = 0;		foreach($child->result() as $row_child){			if($row_child->agdt_add == '1'){				continue;			}		?>		<li id="<?php echo $row_child->agdt_id; ?>" name="<?php echo $row_child->agdt_id; ?>">			<?php 			echo "<span class=\"string\" id=\"agdt_".$row_child->agdt_id."\"><div class=\"tbin\">";						$i = $i + 1;			if($row_child->agdt_level == 0){				echo "<b>".$str_agd . al_to_th($i) . "</b>&nbsp;&nbsp;&nbsp;";				$no_send = $i;				$agdt_no = $i;			} else {				echo "<b>".al_to_th($no) . "." . al_to_th($i) . "</b>&nbsp;&nbsp;&nbsp;";				$no_send = $no . "." . $i;				$agdt_no = $no . "." . $i;			}						echo "<b>".$row_child->agdt_head."</b><br/>";						if($row_child->agdt_detail != "")			{				echo $row_child->agdt_detail;			}			else			{				echo "<br/>";			}						//	เสนอโดย			if($row_child->agdt_by)			{				echo "<b><u>".$str_by."</u></b>&nbsp;&nbsp;".$row_child->agdt_by."<br/><br/>";			}						// File			$ag_file = $rs_file->getFileByAgdtId($row_child->agdt_id);						if($ag_file->num_rows() > 0){				echo "<b><u>".$str_file."</u></b>";				echo "<ul>";				foreach($ag_file->result() as $row_file)				{					echo '<li><a href="'.base_url().'uploads/emeeting/docs/'.$row_file->agfl_nname.'" target="_blank" >- '.$row_file->agfl_oname.'</a></li>';				}				echo "</ul><br/>";			}						// Present			if($row_child->agdt_present != "")			{				echo "<b><u>".$str_present."</u></b>";				echo $row_child->agdt_present;			}					// Result			if($row_child->agdt_result != "")			{				echo "<b><u>".$str_result."</u></b>";				echo $row_child->agdt_result;			}						echo "</div></span>";						if($row_child->child->num_rows()>0){				re_viewAgdt($row_child->child, $no_send, $rs_file);			} 			?>		</li>		<?php			if($row_child->agdt_level == 0){				echo "<hr />";			}		}		?>	</ul><?php}?><div><span style="padding-right:130px;">&nbsp;</span> </div>